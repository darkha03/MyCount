{% extends "layout.html" %}

{% block title %}Plans{% endblock %}
{% block content %}
  <div class="d-flex justify-content-center align-items-center mb-3 p-2 rounded" style="background-color: aquamarine;">
    <h1>Plans Dashboard</h1>
  </div>
  <div class="mb-4 justify-content-center d-flex gap-2">
  <button class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#addPlanModal">Create New Plan</button>
  <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#joinPlanModal">Join Existing Plan</button>
  </div>
  <style>
  /* Ensure action buttons/badges share the same width and fill the action container */
  .action-div {
    display: inline-block;
    min-width: 60px;
    vertical-align: middle;
  }
  .action-div > * {
    display: inline-flex !important;
    align-items: center;
    justify-content: center;
    width: 100% !important;
    box-sizing: border-box;
    white-space: nowrap;
  }
  </style>
  <div id="plan-list" class="row row-cols-1 row-cols-md-2 g-4"></div>
  <!-- Modal for adding new plan -->
  <div class="modal fade" id="addPlanModal" tabindex="-1" aria-labelledby="addPlanLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="add-plan-form">
          <div class="modal-header">
            <h5 class="modal-title" id="addPlanLabel">Create a New Plan</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <div class="modal-body">
            <div class="mb-3">
              <label for="plan-name" class="form-label">Plan Name</label>
              <input type="text" class="form-control" id="plan-name" required>
            </div>

            <div class="mb-2">
              <label class="form-label">Participants</label>
              <div id="participants-list">
                <input type="text" class="form-control mb-2 participant-input" placeholder="Participant 1 (You)">
              </div>
              <div id="add-plan-error" class="mt-2"></div>
              <button type="button" id="add-participant-btn" class="btn btn-sm btn-outline-primary">+ Add Participant</button>
            </div>
          </div>

          <div class="modal-footer">
            <button type="submit" class="btn btn-primary">Save Plan</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal for joining existing plan -->
  <div class="modal fade" id="joinPlanModal" tabindex="-1" aria-labelledby="joinPlanLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="join-plan-form">
          <div class="modal-header">
            <h5 class="modal-title" id="joinPlanLabel">Join an Existing Plan</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="plan-hash-id" class="form-label">Plan Hash ID</label>
              <input type="text" class="form-control" id="plan-hash-id" name="plan_hash_id" required>
            </div>
            <div id="join-response" class="mb-2">
              <button type="button" id="join-plan-btn" class="btn btn-secondary m-3">Search Plan</button>
            </div>
          </div>
          <div id="join-footer" class="modal-footer">
              <button type="button" class="btn btn-secondary" id="reset-join-btn">Reset</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal for modifying plan -->
  <div class="modal fade" id="modifyPlanModal" tabindex="-1" aria-labelledby="modifyPlanLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="modify-plan-form">
          <div class="modal-header">
            <h5 class="modal-title" id="modifyPlanLabel">Modify Plan</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="modify-plan-name" class="form-label">Plan Name</label>
              <input type="text" class="form-control" id="modify-plan-name" required>
            </div>
            <div class="mb-2">
              <label class="form-label">Participants</label>
              <div id="modify-participants-list"></div>
              <div id="modify-plan-error" class="mt-2"></div>
              <button type="button" id="add-modify-participant-btn" class="btn btn-sm btn-outline-primary">+ Add Participant</button>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-warning">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Modal for sharing plan -->
  <div class="modal fade" id="sharePlanModal" tabindex="-1" aria-labelledby="sharePlanLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="sharePlanLabel">Share Plan</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <label for="share-plan-hash-id" class="form-label">Plan Shared ID</label>
          <div class="input-group mb-3">
            <input type="text" class="form-control" id="share-plan-hash-id" readonly>
            <button class="btn btn-outline-secondary" type="button" id="copy-plan-hash-btn">Copy</button>
          </div>
          <div id="copy-feedback" class="text-success" style="display:none;">Copied!</div>
        </div>
      </div>
    </div>
  </div>

  <script src="{{ url_for('static', filename='js/plans_dashboard.js') }}"></script>

{% endblock %}
